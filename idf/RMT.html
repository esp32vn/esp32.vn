

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Remote Control Module &mdash; Tài liệu ESP32 1.0</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Tìm Kiếm" href="../search.html"/>
    <link rel="top" title="Tài liệu ESP32 1.0" href="../index.html"/>
        <link rel="up" title="ESP32 IDF" href="index.html"/>
        <link rel="next" title="WIFI" href="wifi.html"/>
        <link rel="prev" title="GPIO &amp; RTC GPIO" href="gpio.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ESP32
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Phần cứng</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hardware/index.html">Phần cứng</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../hardware/board.html">Board ESP32vn IoT Uno</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware/connection.html">Kết nối máy tính</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../hardware/connection.html#ket-noi-phan-cung">Kết nối phần cứng</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hardware/connection.html#cai-dat-usb-driver">Cài đặt USB Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hardware/connection.html#cau-hinh-ket-noi">Cấu hình kết nối</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">ESP32 Arduino</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arduino/index.html">Arduino cơ bản</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../arduino/install.html">Cài đặt Arduino IDE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../arduino/install.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l3"><a class="reference internal" href="../arduino/install.html#huong-dan">Hướng dẫn</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../arduino/library.html">Cài đặt thư viện</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arduino/blink.html">Blink</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../arduino/blink.html#gioi-thieu">Giới thiệu.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../arduino/blink.html#chuan-bi">Chuẩn bị.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../arduino/blink.html#ket-noi">Kết nối.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../arduino/blink.html#chuong-trinh">Chương trình.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../arduino/blink.html#nap-chuong-trinh">Nạp chương trình.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../arduino/blink.html#ket-luan">Kết luận.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../arduino/i2c_oled.html">I2C/OLED</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../arduino/i2c_oled.html#oled-la-gi">OLED là gì?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../arduino/i2c_oled.html#i2c">I2C</a></li>
<li class="toctree-l3"><a class="reference internal" href="../arduino/i2c_oled.html#demo">Demo</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">ESP32 IDF</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ESP-IDF cơ bản</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install.html">Cài đặt</a><ul>
<li class="toctree-l3"><a class="reference internal" href="install.html#cai-dat-toolchain">Cài đặt Toolchain</a></li>
<li class="toctree-l3"><a class="reference internal" href="install.html#tai-esp-idf">Tải ESP-IDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="install.html#add-idf-path">ADD IDF_PATH</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hello-world.html">Hello World</a><ul>
<li class="toctree-l3"><a class="reference internal" href="hello-world.html#gioi-thieu">Giới thiệu</a></li>
<li class="toctree-l3"><a class="reference internal" href="hello-world.html#demo">Demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="hello-world.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l3"><a class="reference internal" href="hello-world.html#huong-dan">Hướng dẫn</a></li>
<li class="toctree-l3"><a class="reference internal" href="hello-world.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l3"><a class="reference internal" href="hello-world.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="blink-idf.html">Blink</a><ul>
<li class="toctree-l3"><a class="reference internal" href="blink-idf.html#gioi-thieu">Giới thiệu.</a></li>
<li class="toctree-l3"><a class="reference internal" href="blink-idf.html#chuan-bi">Chuẩn bị.</a></li>
<li class="toctree-l3"><a class="reference internal" href="blink-idf.html#ket-noi">Kết nối.</a></li>
<li class="toctree-l3"><a class="reference internal" href="blink-idf.html#demo">Demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="blink-idf.html#huong-dan">Hướng dẫn</a></li>
<li class="toctree-l3"><a class="reference internal" href="blink-idf.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l3"><a class="reference internal" href="blink-idf.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="button.html">Nút nhấn</a><ul>
<li class="toctree-l3"><a class="reference internal" href="button.html#gioi-thieu">Giới thiệu.</a></li>
<li class="toctree-l3"><a class="reference internal" href="button.html#chuan-bi">Chuẩn bị.</a></li>
<li class="toctree-l3"><a class="reference internal" href="button.html#ket-noi">Kết nối.</a></li>
<li class="toctree-l3"><a class="reference internal" href="button.html#demo">Demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="button.html#huong-dan">Hướng dẫn</a></li>
<li class="toctree-l3"><a class="reference internal" href="button.html#lap-trinh">Lập trình</a></li>
<li class="toctree-l3"><a class="reference internal" href="button.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="adc.html">ADC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="adc.html#tong-quan">Tổng quan</a></li>
<li class="toctree-l3"><a class="reference internal" href="adc.html#api-reference">API Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="adc.html#vi-du">Ví dụ</a></li>
<li class="toctree-l3"><a class="reference internal" href="adc.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dac.html">DAC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dac.html#tong-quan">Tổng quan</a></li>
<li class="toctree-l3"><a class="reference internal" href="dac.html#api-reference">API Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="dac.html#vi-du-minh-hoa">Ví dụ minh họa</a></li>
<li class="toctree-l3"><a class="reference internal" href="dac.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spi_master.html">SPI master</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spi_master.html#tong-quan">Tổng quan</a></li>
<li class="toctree-l3"><a class="reference internal" href="spi_master.html#application-example">Application Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="spi_master.html#api-reference-spi-common">API Reference - SPI Common</a></li>
<li class="toctree-l3"><a class="reference internal" href="spi_master.html#api-reference-spi-master">API Reference - SPI Master</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spi_slave.html">SPI slave</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spi_slave.html#tong-quan">Tổng quan</a></li>
<li class="toctree-l3"><a class="reference internal" href="spi_slave.html#application-example">Application Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="spi_slave.html#api-reference">API Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="i2s.html">I2S</a><ul>
<li class="toctree-l3"><a class="reference internal" href="i2s.html#tong-quan">TỔNG QUAN</a></li>
<li class="toctree-l3"><a class="reference internal" href="i2s.html#api-reference">API Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="i2s.html#vi-du">Ví dụ</a></li>
<li class="toctree-l3"><a class="reference internal" href="i2s.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="i2c.html">I2C</a><ul>
<li class="toctree-l3"><a class="reference internal" href="i2c.html#tong-quan">Tổng quan</a></li>
<li class="toctree-l3"><a class="reference internal" href="i2c.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l3"><a class="reference internal" href="i2c.html#vi-du-minh-hoa">Ví dụ minh họa:</a></li>
<li class="toctree-l3"><a class="reference internal" href="i2c.html#api-reference">API Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="i2c.html#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gpio.html">GPIO &amp; RTC GPIO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="gpio.html#tong-quan">Tổng Quan</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gpio.html#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpio.html#vi-du-minh-hoa">Ví dụ minh họa:</a><ul>
<li class="toctree-l3"><a class="reference internal" href="gpio.html#application-example">Application Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="gpio.html#api-reference-normal-gpio">API Reference - Normal GPIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="gpio.html#api-reference-rtc-gpio">API Reference - RTC GPIO</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gpio.html#luu-y">Lưu ý</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Remote Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tong-quan">Tổng quan</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chuan-bi">Chuẩn bị</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vi-du-minh-hoa">Ví dụ minh họa:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api-reference">API Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="#luu-y">Lưu ý</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="wifi.html">Wifi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#tong-quan">Tổng quan</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#vi-du">Ví dụ</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#api-reference">API Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sdcard.html">Thẻ nhớ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sdcard.html#bien-dich-du-an-mau">Biên dịch dự án mẫu</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdcard.html#code">Code</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Hướng dẫn đóng góp</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#cai-dat-cong-cu-can-thiet">Cài đặt công cụ cần thiết</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#viet-bai">Viết bài</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#mot-so-luu-y-khac">Một số lưu ý khác</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#danh-sach-cac-thanh-vien-da-dong-gop">Danh sách các thành viên đã đóng góp</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ESP32</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">ESP32 IDF</a> &raquo;</li>
        
      <li>Remote Control Module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/idf/RMT.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="remote-control-module">
<h1>Remote Control Module<a class="headerlink" href="#remote-control-module" title="Permalink to this headline">¶</a></h1>
<div class="section" id="tong-quan">
<h2>Tổng quan<a class="headerlink" href="#tong-quan" title="Permalink to this headline">¶</a></h2>
<p>Module RMT (Remote Control) chủ yếu được thiết kế để truyền và nhận tín hiệu điều khiển từ xa bằng hồng ngoại. Tuy nhiên do được thiết kế khá linh động, module này còn có thể sử dụng để tạo ra nhiều loại tín hiệu khác. Một bộ phát RMT sẽ liên tục đọc các giá trị từ bộ nhớ và chuyển thành các mức điện áp tương ứng để truyền đi, có thể tùy chọn điều chế tín hiệu với sóng mang hoặc không. Bộ thu sẽ tiến hành kiểm tra khi có tín hiệu tại ngõ vào, có thể tùy chỉnh để lọc tín hiệu, sau đó phân tích và lưu tín hiệu vào bộ nhớ.</p>
<p>RMT module có 8 kênh (channel), được đánh số từ 0 đến 7. Mỗi kênh đều có các thành phần như thanh ghi, khối nhớ và các bộ truyền nhận dữ liệu.</p>
</div>
<div class="section" id="chuan-bi">
<h2>Chuẩn bị<a class="headerlink" href="#chuan-bi" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Tên board mạch</strong></th>
<th class="head"><strong>Link</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Board ESP32 IoT Uno</td>
<td><a class="reference external" href="https://github.com/esp32vn/esp32-iot-uno">https://github.com/esp32vn/esp32-iot-uno</a></td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="vi-du-minh-hoa">
<h2>Ví dụ minh họa:<a class="headerlink" href="#vi-du-minh-hoa" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first"><strong>Ví dụ về module điều khiển từ xa, truyền nhận tín hiệu bằng giao thức NEC, tiến hành tải code mẫu ở:</strong> <a class="reference external" href="https://github.com/espressif/esp-idf/tree/e165336/examples/peripherals/rmt_nec_tx_rx">peripherals/rmt_nec_tx_rx.</a></p>
</li>
<li><dl class="first docutils">
<dt>Có thể test RMT module bằng 2 phương pháp:</dt>
<dd><ul class="first last simple">
<li><dl class="first docutils">
<dt>Self test:</dt>
<dd><ul class="first last">
<li>Tiến hành kết nối chân GPIO TX với chân GPIO RX để truyền nhận tín hiệu. (Trong ví dụ này là GPIO16 và GPIO19).</li>
<li>Tác vụ tx_task sẽ gửi NEC data mà không sử dụng sóng mang (carrier disable).</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Test bằng LED hồng ngoại:</dt>
<dd><ul class="first last">
<li>Ta cần sử dụng sóng mang (carrier enable) cho bộ phát để phát sóng hồng ngoại.</li>
<li>Khi test bằng led hồng ngoại, bộ thu sóng thường tích cực mức thấp.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Các bước thực hiện cơ bản:</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>Tạo gói tin dữ liệu (NEC item) bao gồm các thành phần cơ bản:</dt>
<dd><ul class="first simple">
<li>Phần header: là 1 xung mở đầu gói tin kéo dài 9ms và theo sau là khoảng nghỉ 4.5ms, tổng thời gian truyền là 13.5ms.</li>
<li>Phần data: là 4 bytes (32 bits) được truyền theo sau phần header với bit có trọng số thấp nhất được truyền trước. Trong đó, các byte từ thấp đến cao lần lượt là: byte 1 là byte địa chỉ, byte 2 là đảo của byte 1, byte 3 là phần command chính, byte 4 là đảo của byte 3.</li>
<li>Phần kết thúc: là 1 xung kéo dài 0.56ms.</li>
</ul>
<div class="last line-block">
<div class="line"><strong>Lưu ý</strong>: Trong phần data:</div>
<div class="line-block">
<div class="line">- Bit 1 được thể hiện bằng 1 xung kéo dài khoảng 0.56ms và theo sau là khoảng nghỉ 1.69ms, tổng thời gian truyền 2.25ms.</div>
<div class="line">- Bit 0 được thể hiện bằng 1 xung kéo dài khoảng 0.56ms và theo sau là khoảng nghỉ 0.56ms, tổng thời gian truyền 1.12ms.</div>
</div>
</div>
</dd>
</dl>
</li>
<li><p class="first"><strong>Khởi tạo module RMT TX và RX với các thông số như trong struct</strong> <a class="reference internal" href="#c.rmt_config_t" title="rmt_config_t"><code class="xref c c-data docutils literal"><span class="pre">rmt_config_t</span></code></a> .</p>
</li>
<li><p class="first"><strong>Tiến hành gửi các gói tin đi và xuất thông báo ra màn hình.</strong></p>
</li>
<li><p class="first"><strong>Nhận gói tin, phân tích dữ liệu và in lên màn hình, sau đó giải phóng bộ đệm.</strong></p>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/* NEC remote infrared RMT example</span>

<span class="cm">   This example code is in the Public Domain (or CC0 licensed, at your option.)</span>

<span class="cm">   Unless required by applicable law or agreed to in writing, this</span>
<span class="cm">   software is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR</span>
<span class="cm">   CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;freertos/FreeRTOS.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;freertos/task.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;freertos/queue.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;freertos/semphr.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;esp_err.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;esp_log.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;driver/rmt.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;driver/periph_ctrl.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;soc/rmt_reg.h&quot;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">NEC_TAG</span> <span class="o">=</span> <span class="s">&quot;NEC&quot;</span><span class="p">;</span>

<span class="c1">//CHOOSE SELF TEST OR NORMAL TEST</span>
<span class="cp">#define RMT_RX_SELF_TEST   1</span>

<span class="cm">/******************************************************/</span>
<span class="cm">/*****                SELF TEST:                  *****/</span>
<span class="cm">/*Connect RMT_TX_GPIO_NUM with RMT_RX_GPIO_NUM        */</span>
<span class="cm">/*TX task will send NEC data with carrier disabled    */</span>
<span class="cm">/*RX task will print NEC data it receives.            */</span>
<span class="cm">/******************************************************/</span>
<span class="cp">#if RMT_RX_SELF_TEST</span>
<span class="cp">#define RMT_RX_ACTIVE_LEVEL  1   </span><span class="cm">/*!&lt; Data bit is active high for self test mode */</span><span class="cp"></span>
<span class="cp">#define RMT_TX_CARRIER_EN    0   </span><span class="cm">/*!&lt; Disable carrier for self test mode  */</span><span class="cp"></span>
<span class="cp">#else</span>
<span class="c1">//Test with infrared LED, we have to enable carrier for transmitter</span>
<span class="c1">//When testing via IR led, the receiver waveform is usually active-low.</span>
<span class="cp">#define RMT_RX_ACTIVE_LEVEL  0   </span><span class="cm">/*!&lt; If we connect with a IR receiver, the data is active low */</span><span class="cp"></span>
<span class="cp">#define RMT_TX_CARRIER_EN    1   </span><span class="cm">/*!&lt; Enable carrier for IR transmitter test with IR led */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cp">#define RMT_TX_CHANNEL    1     </span><span class="cm">/*!&lt; RMT channel for transmitter */</span><span class="cp"></span>
<span class="cp">#define RMT_TX_GPIO_NUM  16     </span><span class="cm">/*!&lt; GPIO number for transmitter signal */</span><span class="cp"></span>
<span class="cp">#define RMT_RX_CHANNEL    0     </span><span class="cm">/*!&lt; RMT channel for receiver */</span><span class="cp"></span>
<span class="cp">#define RMT_RX_GPIO_NUM  19     </span><span class="cm">/*!&lt; GPIO number for receiver */</span><span class="cp"></span>
<span class="cp">#define RMT_CLK_DIV      100    </span><span class="cm">/*!&lt; RMT counter clock divider */</span><span class="cp"></span>
<span class="cp">#define RMT_TICK_10_US    (80000000/RMT_CLK_DIV/100000)   </span><span class="cm">/*!&lt; RMT counter value for 10 us.(Source clock is APB clock) */</span><span class="cp"></span>

<span class="cp">#define NEC_HEADER_HIGH_US    9000                         </span><span class="cm">/*!&lt; NEC protocol header: positive 9ms */</span><span class="cp"></span>
<span class="cp">#define NEC_HEADER_LOW_US     4500                         </span><span class="cm">/*!&lt; NEC protocol header: negative 4.5ms*/</span><span class="cp"></span>
<span class="cp">#define NEC_BIT_ONE_HIGH_US    560                         </span><span class="cm">/*!&lt; NEC protocol data bit 1: positive 0.56ms */</span><span class="cp"></span>
<span class="cp">#define NEC_BIT_ONE_LOW_US    (2250-NEC_BIT_ONE_HIGH_US)   </span><span class="cm">/*!&lt; NEC protocol data bit 1: negative 1.69ms */</span><span class="cp"></span>
<span class="cp">#define NEC_BIT_ZERO_HIGH_US   560                         </span><span class="cm">/*!&lt; NEC protocol data bit 0: positive 0.56ms */</span><span class="cp"></span>
<span class="cp">#define NEC_BIT_ZERO_LOW_US   (1120-NEC_BIT_ZERO_HIGH_US)  </span><span class="cm">/*!&lt; NEC protocol data bit 0: negative 0.56ms */</span><span class="cp"></span>
<span class="cp">#define NEC_BIT_END            560                         </span><span class="cm">/*!&lt; NEC protocol end: positive 0.56ms */</span><span class="cp"></span>
<span class="cp">#define NEC_BIT_MARGIN         20                          </span><span class="cm">/*!&lt; NEC parse margin time */</span><span class="cp"></span>

<span class="cp">#define NEC_ITEM_DURATION(d)  ((d &amp; 0x7fff)*10/RMT_TICK_10_US)  </span><span class="cm">/*!&lt; Parse duration time from memory register value */</span><span class="cp"></span>
<span class="cp">#define NEC_DATA_ITEM_NUM   34  </span><span class="cm">/*!&lt; NEC code item number: header + 32bit data + end */</span><span class="cp"></span>
<span class="cp">#define RMT_TX_DATA_NUM  20    </span><span class="cm">/*!&lt; NEC tx test data number */</span><span class="cp"></span>
<span class="cp">#define rmt_item32_tIMEOUT_US  9500   </span><span class="cm">/*!&lt; RMT receiver timeout value(us) */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * @brief Build register value of waveform for NEC one data bit</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">nec_fill_item_level</span><span class="p">(</span><span class="n">rmt_item32_t</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="kt">int</span> <span class="n">high_us</span><span class="p">,</span> <span class="kt">int</span> <span class="n">low_us</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">item</span><span class="o">-&gt;</span><span class="n">level0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">item</span><span class="o">-&gt;</span><span class="n">duration0</span> <span class="o">=</span> <span class="p">(</span><span class="n">high_us</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">RMT_TICK_10_US</span><span class="p">;</span>
    <span class="n">item</span><span class="o">-&gt;</span><span class="n">level1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">item</span><span class="o">-&gt;</span><span class="n">duration1</span> <span class="o">=</span> <span class="p">(</span><span class="n">low_us</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">RMT_TICK_10_US</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * @brief Generate NEC header value: active 9ms + negative 4.5ms</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nec_fill_item_header</span><span class="p">(</span><span class="n">rmt_item32_t</span><span class="o">*</span> <span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">nec_fill_item_level</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">NEC_HEADER_HIGH_US</span><span class="p">,</span> <span class="n">NEC_HEADER_LOW_US</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * @brief Generate NEC data bit 1: positive 0.56ms + negative 1.69ms</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nec_fill_item_bit_one</span><span class="p">(</span><span class="n">rmt_item32_t</span><span class="o">*</span> <span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">nec_fill_item_level</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">NEC_BIT_ONE_HIGH_US</span><span class="p">,</span> <span class="n">NEC_BIT_ONE_LOW_US</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * @brief Generate NEC data bit 0: positive 0.56ms + negative 0.56ms</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nec_fill_item_bit_zero</span><span class="p">(</span><span class="n">rmt_item32_t</span><span class="o">*</span> <span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">nec_fill_item_level</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">NEC_BIT_ZERO_HIGH_US</span><span class="p">,</span> <span class="n">NEC_BIT_ZERO_LOW_US</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * @brief Generate NEC end signal: positive 0.56ms</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nec_fill_item_end</span><span class="p">(</span><span class="n">rmt_item32_t</span><span class="o">*</span> <span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">nec_fill_item_level</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">NEC_BIT_END</span><span class="p">,</span> <span class="mh">0x7fff</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * @brief Check whether duration is around target_us</span>
<span class="cm"> */</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="nf">nec_check_in_range</span><span class="p">(</span><span class="kt">int</span> <span class="n">duration_ticks</span><span class="p">,</span> <span class="kt">int</span> <span class="n">target_us</span><span class="p">,</span> <span class="kt">int</span> <span class="n">margin_us</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">((</span> <span class="n">NEC_ITEM_DURATION</span><span class="p">(</span><span class="n">duration_ticks</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">target_us</span> <span class="o">+</span> <span class="n">margin_us</span><span class="p">))</span>
        <span class="o">&amp;&amp;</span> <span class="p">(</span> <span class="n">NEC_ITEM_DURATION</span><span class="p">(</span><span class="n">duration_ticks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">target_us</span> <span class="o">-</span> <span class="n">margin_us</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * @brief Check whether this value represents an NEC header</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">nec_header_if</span><span class="p">(</span><span class="n">rmt_item32_t</span><span class="o">*</span> <span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">((</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">level0</span> <span class="o">==</span> <span class="n">RMT_RX_ACTIVE_LEVEL</span> <span class="o">&amp;&amp;</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">level1</span> <span class="o">!=</span> <span class="n">RMT_RX_ACTIVE_LEVEL</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="n">nec_check_in_range</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">duration0</span><span class="p">,</span> <span class="n">NEC_HEADER_HIGH_US</span><span class="p">,</span> <span class="n">NEC_BIT_MARGIN</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="n">nec_check_in_range</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">duration1</span><span class="p">,</span> <span class="n">NEC_HEADER_LOW_US</span><span class="p">,</span> <span class="n">NEC_BIT_MARGIN</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * @brief Check whether this value represents an NEC data bit 1</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">nec_bit_one_if</span><span class="p">(</span><span class="n">rmt_item32_t</span><span class="o">*</span> <span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">((</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">level0</span> <span class="o">==</span> <span class="n">RMT_RX_ACTIVE_LEVEL</span> <span class="o">&amp;&amp;</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">level1</span> <span class="o">!=</span> <span class="n">RMT_RX_ACTIVE_LEVEL</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="n">nec_check_in_range</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">duration0</span><span class="p">,</span> <span class="n">NEC_BIT_ONE_HIGH_US</span><span class="p">,</span> <span class="n">NEC_BIT_MARGIN</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="n">nec_check_in_range</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">duration1</span><span class="p">,</span> <span class="n">NEC_BIT_ONE_LOW_US</span><span class="p">,</span> <span class="n">NEC_BIT_MARGIN</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * @brief Check whether this value represents an NEC data bit 0</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">nec_bit_zero_if</span><span class="p">(</span><span class="n">rmt_item32_t</span><span class="o">*</span> <span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">((</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">level0</span> <span class="o">==</span> <span class="n">RMT_RX_ACTIVE_LEVEL</span> <span class="o">&amp;&amp;</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">level1</span> <span class="o">!=</span> <span class="n">RMT_RX_ACTIVE_LEVEL</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="n">nec_check_in_range</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">duration0</span><span class="p">,</span> <span class="n">NEC_BIT_ZERO_HIGH_US</span><span class="p">,</span> <span class="n">NEC_BIT_MARGIN</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="n">nec_check_in_range</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">duration1</span><span class="p">,</span> <span class="n">NEC_BIT_ZERO_LOW_US</span><span class="p">,</span> <span class="n">NEC_BIT_MARGIN</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * @brief Parse NEC 32 bit waveform to address and command.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nec_parse_items</span><span class="p">(</span><span class="n">rmt_item32_t</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="kt">int</span> <span class="n">item_num</span><span class="p">,</span> <span class="kt">uint16_t</span><span class="o">*</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">uint16_t</span><span class="o">*</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">w_len</span> <span class="o">=</span> <span class="n">item_num</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">w_len</span> <span class="o">&lt;</span> <span class="n">NEC_DATA_ITEM_NUM</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">nec_header_if</span><span class="p">(</span><span class="n">item</span><span class="o">++</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">uint16_t</span> <span class="n">addr_t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">nec_bit_one_if</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">addr_t</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">j</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">nec_bit_zero_if</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">addr_t</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="n">j</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">item</span><span class="o">++</span><span class="p">;</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">uint16_t</span> <span class="n">data_t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">nec_bit_one_if</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">data_t</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">j</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">nec_bit_zero_if</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">data_t</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="n">j</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">item</span><span class="o">++</span><span class="p">;</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="n">addr_t</span><span class="p">;</span>
    <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">data_t</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * @brief Build NEC 32bit waveform.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nec_build_items</span><span class="p">(</span><span class="kt">int</span> <span class="n">channel</span><span class="p">,</span> <span class="n">rmt_item32_t</span><span class="o">*</span> <span class="n">item</span><span class="p">,</span> <span class="kt">int</span> <span class="n">item_num</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">cmd_data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">item_num</span> <span class="o">&lt;</span> <span class="n">NEC_DATA_ITEM_NUM</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">nec_fill_item_header</span><span class="p">(</span><span class="n">item</span><span class="o">++</span><span class="p">);</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">addr</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">nec_fill_item_bit_one</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">nec_fill_item_bit_zero</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">item</span><span class="o">++</span><span class="p">;</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
        <span class="n">addr</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">cmd_data</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">nec_fill_item_bit_one</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">nec_fill_item_bit_zero</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">item</span><span class="o">++</span><span class="p">;</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
        <span class="n">cmd_data</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">nec_fill_item_end</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * @brief RMT transmitter initialization</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nec_tx_init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">rmt_config_t</span> <span class="n">rmt_tx</span><span class="p">;</span>
    <span class="n">rmt_tx</span><span class="p">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">RMT_TX_CHANNEL</span><span class="p">;</span>
    <span class="n">rmt_tx</span><span class="p">.</span><span class="n">gpio_num</span> <span class="o">=</span> <span class="n">RMT_TX_GPIO_NUM</span><span class="p">;</span>
    <span class="n">rmt_tx</span><span class="p">.</span><span class="n">mem_block_num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">rmt_tx</span><span class="p">.</span><span class="n">clk_div</span> <span class="o">=</span> <span class="n">RMT_CLK_DIV</span><span class="p">;</span>
    <span class="n">rmt_tx</span><span class="p">.</span><span class="n">tx_config</span><span class="p">.</span><span class="n">loop_en</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">rmt_tx</span><span class="p">.</span><span class="n">tx_config</span><span class="p">.</span><span class="n">carrier_duty_percent</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
    <span class="n">rmt_tx</span><span class="p">.</span><span class="n">tx_config</span><span class="p">.</span><span class="n">carrier_freq_hz</span> <span class="o">=</span> <span class="mi">38000</span><span class="p">;</span>
    <span class="n">rmt_tx</span><span class="p">.</span><span class="n">tx_config</span><span class="p">.</span><span class="n">carrier_level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">rmt_tx</span><span class="p">.</span><span class="n">tx_config</span><span class="p">.</span><span class="n">carrier_en</span> <span class="o">=</span> <span class="n">RMT_TX_CARRIER_EN</span><span class="p">;</span>
    <span class="n">rmt_tx</span><span class="p">.</span><span class="n">tx_config</span><span class="p">.</span><span class="n">idle_level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">rmt_tx</span><span class="p">.</span><span class="n">tx_config</span><span class="p">.</span><span class="n">idle_output_en</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">rmt_tx</span><span class="p">.</span><span class="n">rmt_mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">rmt_config</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rmt_tx</span><span class="p">);</span>
    <span class="n">rmt_driver_install</span><span class="p">(</span><span class="n">rmt_tx</span><span class="p">.</span><span class="n">channel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * @brief RMT receiver initialization</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nec_rx_init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">rmt_config_t</span> <span class="n">rmt_rx</span><span class="p">;</span>
    <span class="n">rmt_rx</span><span class="p">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">RMT_RX_CHANNEL</span><span class="p">;</span>
    <span class="n">rmt_rx</span><span class="p">.</span><span class="n">gpio_num</span> <span class="o">=</span> <span class="n">RMT_RX_GPIO_NUM</span><span class="p">;</span>
    <span class="n">rmt_rx</span><span class="p">.</span><span class="n">clk_div</span> <span class="o">=</span> <span class="n">RMT_CLK_DIV</span><span class="p">;</span>
    <span class="n">rmt_rx</span><span class="p">.</span><span class="n">mem_block_num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">rmt_rx</span><span class="p">.</span><span class="n">rmt_mode</span> <span class="o">=</span> <span class="n">RMT_MODE_RX</span><span class="p">;</span>
    <span class="n">rmt_rx</span><span class="p">.</span><span class="n">rx_config</span><span class="p">.</span><span class="n">filter_en</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">rmt_rx</span><span class="p">.</span><span class="n">rx_config</span><span class="p">.</span><span class="n">filter_ticks_thresh</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">rmt_rx</span><span class="p">.</span><span class="n">rx_config</span><span class="p">.</span><span class="n">idle_threshold</span> <span class="o">=</span> <span class="n">rmt_item32_tIMEOUT_US</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span><span class="n">RMT_TICK_10_US</span><span class="p">);</span>
    <span class="n">rmt_config</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rmt_rx</span><span class="p">);</span>
    <span class="n">rmt_driver_install</span><span class="p">(</span><span class="n">rmt_rx</span><span class="p">.</span><span class="n">channel</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief RMT receiver demo, this task will print each received NEC data.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">rmt_example_nec_rx_task</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">RMT_RX_CHANNEL</span><span class="p">;</span>
    <span class="n">nec_rx_init</span><span class="p">();</span>
    <span class="n">RingbufHandle_t</span> <span class="n">rb</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="c1">//get RMT RX ringbuffer</span>
    <span class="n">rmt_get_ringbuf_handler</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rb</span><span class="p">);</span>
    <span class="n">rmt_rx_start</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="n">rb</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">size_t</span> <span class="n">rx_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="c1">//try to receive data from ringbuffer.</span>
        <span class="c1">//RMT driver will push all the data it receives to its ringbuffer.</span>
        <span class="c1">//We just need to parse the value and return the spaces of ringbuffer.</span>
        <span class="n">rmt_item32_t</span><span class="o">*</span> <span class="n">item</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmt_item32_t</span><span class="o">*</span><span class="p">)</span> <span class="n">xRingbufferReceive</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rx_size</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">uint16_t</span> <span class="n">rmt_addr</span><span class="p">;</span>
            <span class="kt">uint16_t</span> <span class="n">rmt_cmd</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">//parse data value from ringbuffer.</span>
                <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">nec_parse_items</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">rx_size</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">offset</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rmt_addr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rmt_cmd</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(</span><span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="n">res</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">NEC_TAG</span><span class="p">,</span> <span class="s">&quot;RMT RCV --- addr: 0x%04x cmd: 0x%04x&quot;</span><span class="p">,</span> <span class="n">rmt_addr</span><span class="p">,</span> <span class="n">rmt_cmd</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="c1">//after parsing the data, return spaces to ringbuffer.</span>
            <span class="n">vRingbufferReturnItem</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span> <span class="n">item</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">vTaskDelete</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * @brief RMT transmitter demo, this task will periodically send NEC data. (100 * 32 bits each time.)</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">rmt_example_nec_tx_task</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">vTaskDelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="n">nec_tx_init</span><span class="p">();</span>
    <span class="n">esp_log_level_set</span><span class="p">(</span><span class="n">NEC_TAG</span><span class="p">,</span> <span class="n">ESP_LOG_INFO</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">RMT_TX_CHANNEL</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">cmd</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">addr</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nec_tx_num</span> <span class="o">=</span> <span class="n">RMT_TX_DATA_NUM</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
        <span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">NEC_TAG</span><span class="p">,</span> <span class="s">&quot;RMT TX DATA&quot;</span><span class="p">);</span>
        <span class="kt">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">rmt_item32_t</span><span class="p">)</span> <span class="o">*</span> <span class="n">NEC_DATA_ITEM_NUM</span> <span class="o">*</span> <span class="n">nec_tx_num</span><span class="p">);</span>
        <span class="c1">//each item represent a cycle of waveform.</span>
        <span class="n">rmt_item32_t</span><span class="o">*</span> <span class="n">item</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmt_item32_t</span><span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">item_num</span> <span class="o">=</span> <span class="n">NEC_DATA_ITEM_NUM</span> <span class="o">*</span> <span class="n">nec_tx_num</span><span class="p">;</span>
        <span class="n">memset</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span> <span class="n">item</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//To build a series of waveforms.</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">nec_build_items</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">item</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">item_num</span> <span class="o">-</span> <span class="n">offset</span><span class="p">,</span> <span class="p">((</span><span class="o">~</span><span class="n">addr</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">addr</span><span class="p">,</span> <span class="n">cmd</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">cmd</span><span class="o">++</span><span class="p">;</span>
            <span class="n">addr</span><span class="o">++</span><span class="p">;</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">//To send data according to the waveform items.</span>
        <span class="n">rmt_write_items</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">item_num</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
        <span class="c1">//Wait until sending is done.</span>
        <span class="n">rmt_wait_tx_done</span><span class="p">(</span><span class="n">channel</span><span class="p">);</span>
        <span class="c1">//before we free the data, make sure sending is already done.</span>
        <span class="n">free</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
        <span class="n">vTaskDelay</span><span class="p">(</span><span class="mi">2000</span> <span class="o">/</span> <span class="n">portTICK_PERIOD_MS</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">vTaskDelete</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">app_main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">xTaskCreate</span><span class="p">(</span><span class="n">rmt_example_nec_rx_task</span><span class="p">,</span> <span class="s">&quot;rmt_nec_rx_task&quot;</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">xTaskCreate</span><span class="p">(</span><span class="n">rmt_example_nec_tx_task</span><span class="p">,</span> <span class="s">&quot;rmt_nec_tx_task&quot;</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="header-file">
<h3>Header File<a class="headerlink" href="#header-file" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://github.com/espressif/esp-idf/blob/dce7fcb/components/driver/include/driver/rmt.h">driver/include/driver/rmt.h</a></li>
</ul>
</div>
<div class="section" id="mot-so-ham-tham-khao">
<h3>Một số hàm tham khảo<a class="headerlink" href="#mot-so-ham-tham-khao" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.rmt_set_clk_div">
esp_err_t <code class="descname">rmt_set_clk_div</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, uint8_t<em>&nbsp;div_cnt</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_clk_div" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Cài đặt bộ chia clock cho RMT, clock channel được chia từ clock nguồn.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK  Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 -7)</li>
<li><code class="docutils literal"><span class="pre">div_cnt</span></code>: Bộ chia clock cho RMT</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_get_clk_div">
esp_err_t <code class="descname">rmt_get_clk_div</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, uint8_t<em>&nbsp;*div_cnt</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_get_clk_div" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Lấy giá trị từ bộ chia clock đã cài đặt, channel clock được chia từ clock nguồn.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 -7)</li>
<li><code class="docutils literal"><span class="pre">div_cnt</span></code>: con trỏ để tiếp nhận bộ đếm clock RMT</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_rx_idle_thresh">
esp_err_t <code class="descname">rmt_set_rx_idle_thresh</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, uint16_t<em>&nbsp;thresh</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_rx_idle_thresh" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd><p class="first">Cài đặt ngưỡng giá trị nghỉ cho RMT RX.</p>
<p class="last">Trong chế độ nhận, khi không có cạnh xung nào được phát hiện trên tín hiệu vào trong thời gian lâu hơn ngưỡng giá trị nghỉ (tính bằng chu kì xung clock), lúc đó quá trình nhận dữ liệu coi như đã hoàn tất.</p>
</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">thresh</span></code>: Ngưỡng nghỉ cho RMT RX</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_get_rx_idle_thresh">
esp_err_t <code class="descname">rmt_get_rx_idle_thresh</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, uint16_t<em>&nbsp;*thresh</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_get_rx_idle_thresh" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd><p class="first">Lấy về kết quả cài đặt cho ngưỡng giá trị nghỉ của RMT RX.</p>
<p class="last">Trong chế độ nhận, khi không có cạnh xung nào được phát hiện trên tín hiệu vào trong thời gian lâu hơn ngưỡng giá trị nghỉ (tính bằng chu kì xung clock), lúc đó quá trình nhận dữ liệu coi như đã hoàn tất.</p>
</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">thresh</span></code>: Con trỏ để tiếp nhận giá trị nghỉ của RMT RX.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_mem_block_num">
esp_err_t <code class="descname">rmt_set_mem_block_num</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, uint8_t<em>&nbsp;rmt_mem_num</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_mem_block_num" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd><p class="first">Cài đặt số khối nhớ cho kênh RMT.</p>
<p>Hàm này được sử dụng để điều chỉnh số khối nhớ đặt trong kênh n của module RMT. 8 kênh của RMT cùng sử dụng chung một RAM kích thước 512x32-bit có thể được đọc và ghi bởi bộ xử lý trung tâm thông qua APB (Advanced Peripheral Bus), cũng như được đọc bởi bộ phát và ghi bởi bộ thu.</p>
<p>Khoảng địa chỉ RAM giành cho kênh n bắt đầu từ <code class="docutils literal"><span class="pre">start_addr_CHn</span></code> đến <code class="docutils literal"><span class="pre">end_addr_CHn</span></code>, được xác định bởi: Địa chỉ bắt đầu khối nhớ là <strong>RMT_CHANNEL_MEM(n)</strong> (quy định trong file soc/rmt_reg.h), tức là, địa chỉ bắt đầu:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">start_addr_CHn</span></code> = RMT base address + 0x800 + 64*4*n</div></blockquote>
<p>Và địa chỉ kết thúc:</p>
<blockquote class="last">
<div><code class="docutils literal"><span class="pre">end_addr_CHn</span></code> = RMT base address + 0x800 + 64*4*n + 64*4*RMT_MEM_SIZE_CHn mod 512*4.</div></blockquote>
</dd>
<dt>Note:</dt>
<dd>Nếu số khối nhớ của 1 kênh được cài đặt là một giá trị lớn hơn 1, kênh này sẽ chiếm khối nhớ của kênh tiếp theo. Channel0 có thể sử dụng cả 8 khối nhớ của bộ nhớ, trong khi Channel7 chỉ có thể sử dụng 1 khối nhớ.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">rmt_mem_num</span></code>: số khối nhớ của RMT RX, một khối nhớ có kích thước 64*32-bits.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_get_mem_block_num">
esp_err_t <code class="descname">rmt_get_mem_block_num</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, uint8_t<em>&nbsp;*rmt_mem_num</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_get_mem_block_num" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Trả lại số khối nhớ của module RMT.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">rmt_mem_num</span></code>: con trỏ để tiếp nhận số khối nhớ RMT RX.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_tx_carrier">
esp_err_t <code class="descname">rmt_set_tx_carrier</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, bool<em>&nbsp;carrier_en</em>, uint16_t<em>&nbsp;high_level</em>, uint16_t<em>&nbsp;low_level</em>, rmt_carrier_level_t<em>&nbsp;carrier_level</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_tx_carrier" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd><p class="first">Cài đặt sóng mang RMT cho tín hiệu TX.</p>
<p class="last">Bằng cách cài đặt các giá trị khác nhau cho carrier_high và carrier_low, ta có thể cài đặt các tần số khác nhau cho sóng mang. Đơn vị của carrier_high/low là nguồn clock tick, không phải là clock chia cho kênh RMT.</p>
</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last">
<li><p class="first"><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">carrier_en</span></code>: Nếu cho phép ngõ ra sóng mang.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">high_level</span></code>: Khoảng thời gian mức cao của sóng mang.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">low_level</span></code>: Khoảng thời gian mức thấp của sóng mang.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">carrier_level</span></code>: Điều chỉnh cách biến đổi sóng mang cho các kênh.</p>
<blockquote>
<div><ul class="simple">
<li>1'b1: Truyền ngõ ra mức thấp.</li>
<li>1'b0: Truyền ngõ ra mức cao.</li>
</ul>
</div></blockquote>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_mem_pd">
esp_err_t <code class="descname">rmt_set_mem_pd</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, bool<em>&nbsp;pd_en</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_mem_pd" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd><p class="first">Cài đặt bộ nhớ RMT ở chế độ low power (năng lượng thấp).</p>
<p class="last">Cắt giảm năng lượng tiêu tốn bởi bộ nhớ. 1: bộ nhớ đang ở trong trạng thái low power.</p>
</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">pd_en</span></code>: Cho phép bộ nhớ ở chế độ low power.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_get_mem_pd">
esp_err_t <code class="descname">rmt_get_mem_pd</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, bool<em>&nbsp;*pd_en</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_get_mem_pd" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Lấy kết quả cài đặt chế độ low power cho bộ nhớ.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">pd_en</span></code>: Con trỏ để tiếp nhận bộ nhớ chế độ low power của RMT.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_tx_start">
esp_err_t <code class="descname">rmt_tx_start</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, bool<em>&nbsp;tx_idx_rst</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_tx_start" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Cài đặt RMT bắt đầu gửi dữ liệu từ bộ nhớ.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">tx_idx_rst</span></code>: Đặt là &quot;true&quot; để reset chỉ số nhớ cho bộ truyền TX. Các trường hợp còn lại, bộ truyền sẽ tiếp tục gửi dữ liệu từ số chỉ cuối cùng trong bộ nhớ.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_tx_stop">
esp_err_t <code class="descname">rmt_tx_stop</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_tx_stop" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Cài đặt RMT kết thúc gửi dữ liệu.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_rx_start">
esp_err_t <code class="descname">rmt_rx_start</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, bool<em>&nbsp;rx_idx_rst</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_rx_start" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Cài đặt RMT bắt đầu nhận dữ liệu.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">rx_idx_rst</span></code>: Đặt là &quot;true&quot; để reset chỉ số nhớ cho bộ thu RX. Các trường hợp còn lại, bộ thu sẽ tiếp tục nhận dữ liệu từ số chỉ cuối cùng trong bộ nhớ.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_rx_stop">
esp_err_t <code class="descname">rmt_rx_stop</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_rx_stop" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Cài đặt RMT kết thúc nhận dữ liệu.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_memory_rw_rst">
esp_err_t <code class="descname">rmt_memory_rw_rst</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_memory_rw_rst" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Reset chỉ số nhớ bộ truyền và nhận của RMT.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_memory_owner">
esp_err_t <code class="descname">rmt_set_memory_owner</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, rmt_mem_owner_t<em>&nbsp;owner</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_memory_owner" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Cài đặt quyền sở hữu bộ nhớ của RMT.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">owner</span></code>: Cài đặt khi nào thì bộ truyền hay bộ nhận có thể truy cập để xử lý dữ liệu trong bộ nhớ của channel.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_get_memory_owner">
esp_err_t <code class="descname">rmt_get_memory_owner</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, rmt_mem_owner_t<em>&nbsp;*owner</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_get_memory_owner" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Lấy kết quả cài đặt quyền sở hữu bộ nhớ của RMT.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">owner</span></code>: Con trỏ để lấy quyền sử dụng bộ nhớ.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_tx_loop_mode">
esp_err_t <code class="descname">rmt_set_tx_loop_mode</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, bool<em>&nbsp;loop_en</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_tx_loop_mode" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Cài đặt chế độ lặp cho bộ truyền RMT.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">loop_en</span></code>: cho phép bộ truyền của RMT ở chế độ truyền lặp vòng.</dt>
<dd>Nếu đặt là &quot;true&quot; thì bộ truyền sẽ tiếp tục gửi từ dữ liệu đầu tiên đến dữ liệu cuối trong channel0-7 lặp đi lặp lại.</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_get_tx_loop_mode">
esp_err_t <code class="descname">rmt_get_tx_loop_mode</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, bool<em>&nbsp;*loop_en</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_get_tx_loop_mode" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Lấy chế độ truyền lặp vòng của RMT</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">loop_en</span></code>: con trỏ để tiếp nhận chế độ truyền lặp vòng của RMT.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_rx_filter">
esp_err_t <code class="descname">rmt_set_rx_filter</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, bool<em>&nbsp;rx_filter_en</em>, uint8_t<em>&nbsp;thresh</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_rx_filter" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd><p class="first">Cài đặt bộ lọc cho RMT RX.</p>
<p class="last">Trong chế độ nhận, channel0-7 sẽ bỏ qua xung ngõ vào khi độ rộng xung này nhỏ hơn mức ngưỡng quy định. Độ rộng này tính bằng clock nguồn, không phải clock đã chia cho channel.</p>
</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_FAIL(-1) Parameter error</li>
<li>Others(&gt;=0) Số byte dữ liệu đọc được từ slave buffer.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">rx_filter_en</span></code>: Cho phép sử dụng lọc trong bộ thu RMT.</li>
<li><code class="docutils literal"><span class="pre">thresh</span></code>: Ngưỡng độ rộng xung cho bộ thu.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_source_clk">
esp_err_t <code class="descname">rmt_set_source_clk</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, rmt_source_clk_t<em>&nbsp;base_clk</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_source_clk" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd><p class="first">Cài đặt nguồn clock cho RMT.</p>
<dl class="last docutils">
<dt>Module RMT có 2 nguồn clock là:</dt>
<dd><ol class="first last arabic simple">
<li>APB clock tương ứng 80MHz</li>
<li>REF tick clock tương ứng 1MHz (không được hỗ trợ trong phiên bản này.)</li>
</ol>
</dd>
</dl>
</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">base_clk</span></code>: Chọn nguồn clock cho module RMT.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_get_source_clk">
esp_err_t <code class="descname">rmt_get_source_clk</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, rmt_source_clk_t<em>&nbsp;*src_clk</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_get_source_clk" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Lấy nguồn clock cho module RMT.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">src_clk</span></code>: Con trỏ tiếp nhận nguồn clock cho module RMT.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_idle_level">
esp_err_t <code class="descname">rmt_set_idle_level</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, bool<em>&nbsp;idle_out_en</em>, rmt_idle_level_t<em>&nbsp;level</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_idle_level" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Cài đặt mức chế độ nghỉ ngõ ra cho bộ truyền RMT</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">idle_out_en</span></code>: Cho phép mức chế độ nghỉ ngõ ra.</li>
<li><code class="docutils literal"><span class="pre">level</span></code>: Cài đặt mức tín hiệu ngõ ra khi ở trạng thái nghỉ cho channel0-7.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_get_status">
esp_err_t <code class="descname">rmt_get_status</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, uint32_t<em>&nbsp;*status</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_get_status" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Lấy trạng thái của module RMT.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">status</span></code>: con trỏ để tiếp nhận trạng thái kênh.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_intr_enable_mask">
void <code class="descname">rmt_set_intr_enable_mask</code><span class="sig-paren">(</span>uint32_t<em>&nbsp;mask</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_intr_enable_mask" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Đặt giá trị mặt nạ cho thanh ghi cho phép ngắt của RMT.</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">mask</span></code>: bit mặt nạ để cài đặt thanh ghi.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_clr_intr_enable_mask">
void <code class="descname">rmt_clr_intr_enable_mask</code><span class="sig-paren">(</span>uint32_t<em>&nbsp;mask</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_clr_intr_enable_mask" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Giá trị mặt nạ để xóa cài đặt thanh ghi cho phép ngắt.</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">mask</span></code>: bit mặt nạ để xóa cài đặt thanh ghi.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_rx_intr_en">
esp_err_t <code class="descname">rmt_set_rx_intr_en</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, bool<em>&nbsp;en</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_rx_intr_en" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Cài đặt cho phép ngắt thu RMT.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">en</span></code>: cho phép hoặc không cho phép ngắt thu RMT.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_err_intr_en">
esp_err_t <code class="descname">rmt_set_err_intr_en</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, bool<em>&nbsp;en</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_err_intr_en" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Cài đặt cho phép lỗi ngắt thu RMT.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">en</span></code>: cho phép hoặc không cho phép lỗi ngắt thu RMT.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_tx_intr_en">
esp_err_t <code class="descname">rmt_set_tx_intr_en</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, bool<em>&nbsp;en</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_tx_intr_en" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Cài đặt cho phép ngắt phát RMT.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">en</span></code>: cho phép hoặc không cho phép ngắt phát RMT.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_tx_thr_intr_en">
esp_err_t <code class="descname">rmt_set_tx_thr_intr_en</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, bool<em>&nbsp;en</em>, uint16_t<em>&nbsp;evt_thresh</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_tx_thr_intr_en" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd><p class="first">Cài đặt cho phép ngắt ngưỡng sự kiện phát RMT.</p>
<p class="last">Gây ra 1 ngắt khi có một số lượng dữ liệu được truyền xong. Số lượng này có thể cài đặt được gọi là ngưỡng.</p>
</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">en</span></code>: cho phép hoặc không cho phép ngắt phát theo sự kiện.</li>
<li><code class="docutils literal"><span class="pre">evt_thresh</span></code>: Giá trị ngưỡng để ngắt sự kiện cho RMT.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_set_pin">
esp_err_t <code class="descname">rmt_set_pin</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, rmt_mode_t<em>&nbsp;mode</em>, <a class="reference internal" href="gpio.html#c.gpio_num_t" title="gpio_num_t">gpio_num_t</a><em>&nbsp;gpio_num</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_set_pin" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Cài đặt chân cho module RMT.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">mode</span></code>: Chế độ truyền (TX) hay nhận (RX) cho RMT.</li>
<li><code class="docutils literal"><span class="pre">gpio_num</span></code>: Tên chân GPIO để truyền/nhận tín hiệu.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_config">
esp_err_t <code class="descname">rmt_config</code><span class="sig-paren">(</span>const <a class="reference internal" href="#c.rmt_config_t" title="rmt_config_t">rmt_config_t</a><em>&nbsp;*rmt_param</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_config" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Cấu hình các thông số cho RMT.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">rmt_param</span></code>: Con trỏ đến trường chứa thông số cho RMT.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_isr_register">
esp_err_t <code class="descname">rmt_isr_register</code><span class="sig-paren">(</span>void (<em>*fn</em>)(void *), void<em>&nbsp;*arg</em>, int<em>&nbsp;intr_alloc_flags</em>, <a class="reference internal" href="#c.rmt_isr_handle_t" title="rmt_isr_handle_t">rmt_isr_handle_t</a><em>&nbsp;*handle</em>, <span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_isr_register" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd><p class="first">Đăng kí trình xử lý ngắt cho RMT. Trình xử lý này là một trình phục vụ ngắt.</p>
<p class="last">Trình xử lý này sẽ được đính kèm vào chung bộ xử lý trung tâm đã gọi hàm này.</p>
</dd>
<dt>Note:</dt>
<dd>Nếu đã gọi hàm rmt_driver_install để sử dụng RMT driver thì không được đăng kí trình phục vụ ngắt nữa.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
<li>ESP_FAIL Driver hệ thống đã được cài đặt, không thể đăng kí trình phục vụ ngắt cho RMT.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">fn</span></code>: tên hàm xử lý ngắt.</li>
<li><code class="docutils literal"><span class="pre">arg</span></code>: đối số cho hàm xử lý ngắt.</li>
<li><code class="docutils literal"><span class="pre">intr_alloc_flags</span></code>: Các cờ sử dụng để cấp phát ngắt. Một hay nhiều giá trị ESP_INTR_FLAG_* dùng để xác định mức độ ưu tiên cho ngắt. Được quy định trong file esp_intr_alloc.h</li>
<li><code class="docutils literal"><span class="pre">handle</span></code>: Nếu khác 0, một trình xử lý khác sẽ được tạo ra để xóa trình phục vụ ngắt lưu ở đây.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_isr_deregister">
esp_err_t <code class="descname">rmt_isr_deregister</code><span class="sig-paren">(</span><a class="reference internal" href="#c.rmt_isr_handle_t" title="rmt_isr_handle_t">rmt_isr_handle_t</a><em>&nbsp;handle</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_isr_deregister" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Hủy đăng kí trình xử lý ngắt RMT đã có.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">handle</span></code>: trình xử lý có được khi gọi hàm rmt_isr_deregister.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_fill_tx_items">
esp_err_t <code class="descname">rmt_fill_tx_items</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, const rmt_item32_t<em>&nbsp;*item</em>, uint16_t<em>&nbsp;item_num</em>, uint16_t<em>&nbsp;mem_offset</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_fill_tx_items" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Lấp đầy bộ nhớ dữ liệu của channel bằng các gói tin của RMT.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">item</span></code>: Con trỏ chỉ tới các gói tin.</li>
<li><code class="docutils literal"><span class="pre">item_num</span></code>: số gói tin gửi đi.</li>
<li><code class="docutils literal"><span class="pre">mem_offset</span></code>: Số chỉ của bộ nhớ.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_driver_install">
esp_err_t <code class="descname">rmt_driver_install</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, size_t<em>&nbsp;rx_buf_size</em>, int<em>&nbsp;intr_alloc_flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_driver_install" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Khởi tạo RMT driver.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
<li>ESP_ERR_NO_MEM Cấp phát bộ nhớ thất bại.</li>
<li>ESP_ERR_INVALID_STATE Driver đã được cài đặt rồi, gọi hàm rmt_driver_uninstall trước.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">rx_buf_size</span></code>: Kích thước bộ đệm thu. Có thể cài là 0 nếu không sử dụng bộ đệm thu.</li>
<li><code class="docutils literal"><span class="pre">intr_alloc_flags</span></code>: Các cờ sử dụng cho ngắt. Đặt là 0 để sử dụng cờ mặc định. Xem file esp_intr_alloc.h để biết thông tin chi tiết.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_driver_uninstall">
esp_err_t <code class="descname">rmt_driver_uninstall</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_driver_uninstall" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Gỡ cài đặt driver</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_write_items">
esp_err_t <code class="descname">rmt_write_items</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, const rmt_item32_t<em>&nbsp;*rmt_item</em>, int<em>&nbsp;item_num</em>, bool<em>&nbsp;wait_tx_done</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_write_items" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd><p class="first">RMT gửi đi dạng sóng từ mảng rmt_item.</p>
<p class="last">API này cho phép người dùng gửi đi sóng có chiều dài bất kì.</p>
</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">rmt_item</span></code>: Con trỏ tới địa chỉ đầu tiên của mảng gói tin.</li>
<li><code class="docutils literal"><span class="pre">item_num</span></code>: Số lượng gói tin dữ liệu.</li>
<li><code class="docutils literal"><span class="pre">wait_tx_done</span></code>: Nếu cài đặt là 1, nó sẽ chặn các tác vụ khác và chờ cho đến khi việc gửi đi hoàn tất.</li>
</ul>
<div class="last highlight-c"><div class="highlight"><pre><span></span>Nếu cài đặt là 0, nó sẽ không chờ và return ngay lập tức.
@note
Hàm này sẽ không sao chép dữ liệu, thay vào đó, nó sẽ trỏ tới dữ liệu gốc,
và gửi đi dữ liệu theo dạng sóng.
Nếu wait_tx_done được cài là &quot;true&quot;, hàm này sẽ chặn và không return cho đến khi
tất cả dữ liệu được gửi đi.
Nếu wait_tx_done được cài là &quot;false&quot;, hàm này sẽ return ngay lập tức, và một trình điểu khiển ngắt
(driver interrupt) sẽ tiếp tục gửi dữ liệu đi.
Ta phải đảm bảo dữ liệu sẽ không bị mất khi driver gửi dữ liệu đi trong driver interrupt.
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_wait_tx_done">
esp_err_t <code class="descname">rmt_wait_tx_done</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_wait_tx_done" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd>Chờ RMT gửi hoàn tất.</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="c.rmt_get_ringbuf_handler">
esp_err_t <code class="descname">rmt_get_ringbuf_handler</code><span class="sig-paren">(</span>rmt_channel_t<em>&nbsp;channel</em>, RingbufHandle_t<em>&nbsp;*buf_handler</em><span class="sig-paren">)</span><a class="headerlink" href="#c.rmt_get_ringbuf_handler" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Mô tả hàm:</dt>
<dd><p class="first">Lấy bộ đệm (ringbuffer) từ UART</p>
<p class="last">Người dùng có thể lấy trình xử lý bộ đệm thu, và xử lý dữ liệu thu được.</p>
</dd>
<dt>Kết quả trả về:</dt>
<dd><ul class="first last simple">
<li>ESP_OK Thành công.</li>
<li>ESP_ERR_INVALID_ARG Lỗi đối số.</li>
</ul>
</dd>
<dt>Các đối số:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">channel</span></code>: kênh của RMT (0 - 7)</li>
<li><code class="docutils literal"><span class="pre">buf_handler</span></code>: Con trỏ đến buffer handler để tiếp nhận trình xử lý bộ đệm thu.</li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="structures">
<h3>Structures<a class="headerlink" href="#structures" title="Permalink to this headline">¶</a></h3>
<dl class="member">
<dt id="c.rmt_tx_config_t">
struct <code class="descname">rmt_tx_config_t</code><a class="headerlink" href="#c.rmt_tx_config_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Trường dữ liệu của RMT TX dùng để cấu hình các thông số.</p>
<blockquote>
<div><p><strong>Public Members</strong></p>
<dl class="member">
<dt id="c.loop_en">
bool <code class="descname">loop_en</code><a class="headerlink" href="#c.loop_en" title="Permalink to this definition">¶</a></dt>
<dd><p>Chế độ truyền lặp vòng cho RMT.</p>
</dd></dl>

<dl class="member">
<dt id="c.carrier_freq_hz">
uint32_t <code class="descname">carrier_freq_hz</code><a class="headerlink" href="#c.carrier_freq_hz" title="Permalink to this definition">¶</a></dt>
<dd><p>Tần số sóng mang cho RMT.</p>
</dd></dl>

<dl class="member">
<dt id="c.carrier_duty_percent">
uint8_t <code class="descname">carrier_duty_percent</code><a class="headerlink" href="#c.carrier_duty_percent" title="Permalink to this definition">¶</a></dt>
<dd><p>Hiệu suất sóng mang của RMT. (%)</p>
</dd></dl>

<dl class="member">
<dt id="c.carrier_level">
rmt_carrier_level_t <code class="descname">carrier_level</code><a class="headerlink" href="#c.carrier_level" title="Permalink to this definition">¶</a></dt>
<dd><p>Mức sóng mang của RMT</p>
</dd></dl>

<dl class="member">
<dt id="c.carrier_en">
bool <code class="descname">carrier_en</code><a class="headerlink" href="#c.carrier_en" title="Permalink to this definition">¶</a></dt>
<dd><p>Cho phép RMT sử dụng sóng mang.</p>
</dd></dl>

<dl class="member">
<dt id="c.idle_level">
rmt_idle_level_t <code class="descname">idle_level</code><a class="headerlink" href="#c.idle_level" title="Permalink to this definition">¶</a></dt>
<dd><p>Mức chế độ nghỉ của RMT.</p>
</dd></dl>

<dl class="member">
<dt id="c.idle_output_en">
bool <code class="descname">idle_output_en</code><a class="headerlink" href="#c.idle_output_en" title="Permalink to this definition">¶</a></dt>
<dd><p>Cho phép mức chế độ nghỉ ở ngõ ra.</p>
</dd></dl>

</div></blockquote>
</dd></dl>

<dl class="member">
<dt id="c.rmt_rx_config_t">
struct <code class="descname">rmt_rx_config_t</code><a class="headerlink" href="#c.rmt_rx_config_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Trường dữ liệu của RMT RX dùng để cấu hình các thông số.</p>
<blockquote>
<div><strong>Public Members</strong></div></blockquote>
<dl class="member">
<dt id="c.filter_en">
bool <code class="descname">filter_en</code><a class="headerlink" href="#c.filter_en" title="Permalink to this definition">¶</a></dt>
<dd><p>Cho phép chức năng bộ lọc thu.</p>
</dd></dl>

<dl class="member">
<dt id="c.filter_ticks_thresh">
uint8_t <code class="descname">filter_ticks_thresh</code><a class="headerlink" href="#c.filter_ticks_thresh" title="Permalink to this definition">¶</a></dt>
<dd><p>Số tick hệ thống để lọc dữ liệu khi nhận vào.</p>
</dd></dl>

<dl class="member">
<dt id="c.idle_threshold">
uint16_t <code class="descname">idle_threshold</code><a class="headerlink" href="#c.idle_threshold" title="Permalink to this definition">¶</a></dt>
<dd><p>Ngưỡng nghỉ cho RMT RX.</p>
</dd></dl>

</dd></dl>

<dl class="member">
<dt id="c.rmt_config_t">
struct <code class="descname">rmt_config_t</code><a class="headerlink" href="#c.rmt_config_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Trường dữ liệu của RMT dùng để cấu hình các thông số.</p>
<blockquote>
<div><strong>Public Members</strong></div></blockquote>
<dl class="member">
<dt id="c.rmt_mode">
rmt_mode_t <code class="descname">rmt_mode</code><a class="headerlink" href="#c.rmt_mode" title="Permalink to this definition">¶</a></dt>
<dd><p>Chế độ RMT: phát hay thu.</p>
</dd></dl>

<dl class="member">
<dt id="c.channel">
rmt_channel_t <code class="descname">channel</code><a class="headerlink" href="#c.channel" title="Permalink to this definition">¶</a></dt>
<dd><p>RMT channel.</p>
</dd></dl>

<dl class="member">
<dt id="c.clk_div">
uint8_t <code class="descname">clk_div</code><a class="headerlink" href="#c.clk_div" title="Permalink to this definition">¶</a></dt>
<dd><p>Bộ chia clock cho channel.</p>
</dd></dl>

<dl class="member">
<dt id="c.gpio_num">
<a class="reference internal" href="gpio.html#c.gpio_num_t" title="gpio_num_t">gpio_num_t</a> <code class="descname">gpio_num</code><a class="headerlink" href="#c.gpio_num" title="Permalink to this definition">¶</a></dt>
<dd><p>Chân GPIO cho RMT.</p>
</dd></dl>

<dl class="member">
<dt id="c.mem_block_num">
uint8_t <code class="descname">mem_block_num</code><a class="headerlink" href="#c.mem_block_num" title="Permalink to this definition">¶</a></dt>
<dd><p>Số khối nhớ của RMT.</p>
</dd></dl>

<dl class="member">
<dt id="c.tx_config">
<a class="reference internal" href="#c.rmt_tx_config_t" title="rmt_tx_config_t">rmt_tx_config_t</a> <code class="descname">tx_config</code><a class="headerlink" href="#c.tx_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Thông số cho RMT TX</p>
</dd></dl>

<dl class="member">
<dt id="c.rx_config">
<a class="reference internal" href="#c.rmt_rx_config_t" title="rmt_rx_config_t">rmt_rx_config_t</a> <code class="descname">rx_config</code><a class="headerlink" href="#c.rx_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Thông số cho RMT RX</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="macro">
<h3>Macro<a class="headerlink" href="#macro" title="Permalink to this headline">¶</a></h3>
<dl class="macro">
<dt id="c.RMT_MEM_BLOCK_BYTE_NUM">
<code class="descname">RMT_MEM_BLOCK_BYTE_NUM</code><span class="sig-paren">(</span>256<span class="sig-paren">)</span><a class="headerlink" href="#c.RMT_MEM_BLOCK_BYTE_NUM" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="macro">
<dt id="c.RMT_MEM_ITEM_NUM">
<code class="descname">RMT_MEM_ITEM_NUM</code><span class="sig-paren">(</span><a class="reference internal" href="#c.RMT_MEM_BLOCK_BYTE_NUM" title="RMT_MEM_BLOCK_BYTE_NUM">RMT_MEM_BLOCK_BYTE_NUM</a>/4<span class="sig-paren">)</span><a class="headerlink" href="#c.RMT_MEM_ITEM_NUM" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="type-definitions">
<h3>Type Definitions<a class="headerlink" href="#type-definitions" title="Permalink to this headline">¶</a></h3>
<dl class="type">
<dt id="c.rmt_isr_handle_t">
typedef intr_handle_t <code class="descname">rmt_isr_handle_t</code><a class="headerlink" href="#c.rmt_isr_handle_t" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="enumerations">
<h3>Enumerations<a class="headerlink" href="#enumerations" title="Permalink to this headline">¶</a></h3>
<dl class="enum">
<dt id="_CPPv213rmt_channel_t">
<em class="property">enum </em><code class="descclassname"></code><code class="descname">rmt_channel_t</code><a class="headerlink" href="#_CPPv213rmt_channel_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p><cite>Các giá trị</cite>:</p>
<dl class="macro">
<dt id="c.0">
RMT_CHANNEL_0 = <code class="descname">0</code><a class="headerlink" href="#c.0" title="Permalink to this definition">¶</a></dt>
<dd><p>RMT channel0</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_CHANNEL_1">
<code class="descname">RMT_CHANNEL_1</code><a class="headerlink" href="#c.RMT_CHANNEL_1" title="Permalink to this definition">¶</a></dt>
<dd><p>RMT channel1</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_CHANNEL_2">
<code class="descname">RMT_CHANNEL_2</code><a class="headerlink" href="#c.RMT_CHANNEL_2" title="Permalink to this definition">¶</a></dt>
<dd><p>RMT channel2</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_CHANNEL_3">
<code class="descname">RMT_CHANNEL_3</code><a class="headerlink" href="#c.RMT_CHANNEL_3" title="Permalink to this definition">¶</a></dt>
<dd><p>RMT channel3</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_CHANNEL_4">
<code class="descname">RMT_CHANNEL_4</code><a class="headerlink" href="#c.RMT_CHANNEL_4" title="Permalink to this definition">¶</a></dt>
<dd><p>RMT channel4</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_CHANNEL_5">
<code class="descname">RMT_CHANNEL_5</code><a class="headerlink" href="#c.RMT_CHANNEL_5" title="Permalink to this definition">¶</a></dt>
<dd><p>RMT channel5</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_CHANNEL_6">
<code class="descname">RMT_CHANNEL_6</code><a class="headerlink" href="#c.RMT_CHANNEL_6" title="Permalink to this definition">¶</a></dt>
<dd><p>RMT channel6</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_CHANNEL_7">
<code class="descname">RMT_CHANNEL_7</code><a class="headerlink" href="#c.RMT_CHANNEL_7" title="Permalink to this definition">¶</a></dt>
<dd><p>RMT channel7</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_CHANNEL_MAX">
<code class="descname">RMT_CHANNEL_MAX</code><a class="headerlink" href="#c.RMT_CHANNEL_MAX" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="enum">
<dt id="_CPPv215rmt_mem_owner_t">
<em class="property">enum </em><code class="descclassname"></code><code class="descname">rmt_mem_owner_t</code><a class="headerlink" href="#_CPPv215rmt_mem_owner_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p><cite>Các giá trị</cite>:</p>
<dl class="macro">
<dt>
RMT_MEM_OWNER_TX = <code class="descname">0</code></dt>
<dd><p>RMT TX mode, bộ phát sử dụng khối nhớ.</p>
</dd></dl>

<dl class="macro">
<dt id="c.1">
RMT_MEM_OWNER_RX = <code class="descname">1</code><a class="headerlink" href="#c.1" title="Permalink to this definition">¶</a></dt>
<dd><p>RMT RX mode, bộ thu sử dụng khối nhớ.</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_MEM_OWNER_MAX">
<code class="descname">RMT_MEM_OWNER_MAX</code><a class="headerlink" href="#c.RMT_MEM_OWNER_MAX" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="enum">
<dt id="_CPPv216rmt_source_clk_t">
<em class="property">enum </em><code class="descclassname"></code><code class="descname">rmt_source_clk_t</code><a class="headerlink" href="#_CPPv216rmt_source_clk_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p><cite>Các gía trị</cite>:</p>
<dl class="macro">
<dt>
RMT_BASECLK_REF = <code class="descname">0</code></dt>
<dd><p>Nguồn clock của RMT là REF clock, mặc định là 1MHz (Không hỗ trợ ở phiên bản này)</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_BASECLK_APB">
<code class="descname">RMT_BASECLK_APB</code><a class="headerlink" href="#c.RMT_BASECLK_APB" title="Permalink to this definition">¶</a></dt>
<dd><p>Nguồn clock của RMT là APB (Advanced Peripheral Bus) clock, mặc định là 80MHz.</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_BASECLK_MAX">
<code class="descname">RMT_BASECLK_MAX</code><a class="headerlink" href="#c.RMT_BASECLK_MAX" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="enum">
<dt id="_CPPv215rmt_data_mode_t">
<em class="property">enum </em><code class="descclassname"></code><code class="descname">rmt_data_mode_t</code><a class="headerlink" href="#_CPPv215rmt_data_mode_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p><cite>Các giá trị</cite>:</p>
<dl class="macro">
<dt>
RMT_DATA_MODE_FIFO = <code class="descname">0</code></dt>
<dd></dd></dl>

<dl class="macro">
<dt>
RMT_DATA_MODE_MEM = <code class="descname">1</code></dt>
<dd></dd></dl>

<dl class="macro">
<dt id="c.RMT_DATA_MODE_MAX">
<code class="descname">RMT_DATA_MODE_MAX</code><a class="headerlink" href="#c.RMT_DATA_MODE_MAX" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="enum">
<dt id="_CPPv210rmt_mode_t">
<em class="property">enum </em><code class="descclassname"></code><code class="descname">rmt_mode_t</code><a class="headerlink" href="#_CPPv210rmt_mode_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p><cite>Các giá trị</cite>:</p>
<blockquote>
<div><dl class="macro">
<dt>
RMT_MODE_TX = <code class="descname">0</code></dt>
<dd><p>RMT TX mode.</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_MODE_RX">
<code class="descname">RMT_MODE_RX</code><a class="headerlink" href="#c.RMT_MODE_RX" title="Permalink to this definition">¶</a></dt>
<dd><p>RMT RX mode</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_MODE_MAX">
<code class="descname">RMT_MODE_MAX</code><a class="headerlink" href="#c.RMT_MODE_MAX" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div></blockquote>
</dd></dl>

<dl class="enum">
<dt id="_CPPv216rmt_idle_level_t">
<em class="property">enum </em><code class="descclassname"></code><code class="descname">rmt_idle_level_t</code><a class="headerlink" href="#_CPPv216rmt_idle_level_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p><cite>Các giá trị</cite>:</p>
<blockquote>
<div><dl class="macro">
<dt>
RMT_IDLE_LEVEL_LOW = <code class="descname">0</code></dt>
<dd><p>Mức nghỉ cho RMT TX: mức thấp</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_IDLE_LEVEL_HIGH">
<code class="descname">RMT_IDLE_LEVEL_HIGH</code><a class="headerlink" href="#c.RMT_IDLE_LEVEL_HIGH" title="Permalink to this definition">¶</a></dt>
<dd><p>Mức nghỉ cho RMT TX: mức cao</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_IDLE_LEVEL_MAX">
<code class="descname">RMT_IDLE_LEVEL_MAX</code><a class="headerlink" href="#c.RMT_IDLE_LEVEL_MAX" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div></blockquote>
</dd></dl>

<dl class="enum">
<dt id="_CPPv219rmt_carrier_level_t">
<em class="property">enum </em><code class="descclassname"></code><code class="descname">rmt_carrier_level_t</code><a class="headerlink" href="#_CPPv219rmt_carrier_level_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p><cite>Các giá trị</cite>:</p>
<blockquote>
<div><dl class="macro">
<dt>
RMT_CARRIER_LEVEL_LOW = <code class="descname">0</code></dt>
<dd><p>Sóng mang RMT được biến đổi để ngõ ra mức thấp.</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_CARRIER_LEVEL_HIGH">
<code class="descname">RMT_CARRIER_LEVEL_HIGH</code><a class="headerlink" href="#c.RMT_CARRIER_LEVEL_HIGH" title="Permalink to this definition">¶</a></dt>
<dd><p>Sóng mang RMT được biến đổi để ngõ ra mức cao.</p>
</dd></dl>

<dl class="macro">
<dt id="c.RMT_CARRIER_LEVEL_MAX">
<code class="descname">RMT_CARRIER_LEVEL_MAX</code><a class="headerlink" href="#c.RMT_CARRIER_LEVEL_MAX" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div></blockquote>
</dd></dl>

</div>
</div>
<div class="section" id="luu-y">
<h2>Lưu ý<a class="headerlink" href="#luu-y" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Hướng dẫn cài đặt <a class="reference external" href="https://esp-idf.readthedocs.io/en/latest/index.html">ESP-IDF</a></li>
<li>Nạp và Debug chương trình <a class="reference external" href="https://esp-idf.readthedocs.io/en/latest/index.html">xem tại đây</a></li>
<li>Tài nguyên hệ thống xem <a class="reference external" href="https://github.com/espressif/esp-idf">tại đây</a></li>
</ul>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="wifi.html" class="btn btn-neutral float-right" title="WIFI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="gpio.html" class="btn btn-neutral" title="GPIO &amp; RTC GPIO" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, TuanPM.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            LANGUAGE:'vi',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-60470603-07");
pageTracker._trackPageview();
} catch(err) {}</script>


</body>
</html>